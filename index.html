/* --- LOGIQUE DE TRADUCTION --- */
function setLanguage(lang) {
    // Mettre à jour la langue du corps
    document.body.setAttribute('data-lang', lang);

    // Gérer les classes actives du sélecteur
    document.getElementById('lang-en').classList.remove('active');
    document.getElementById('lang-fr').classList.remove('active');
    document.getElementById('lang-' + lang).classList.add('active');

    // Mettre à jour le titre de la page (élément <title>)
    const titleElement = document.getElementById('page-title');
    if (titleElement) {
        const newTitle = titleElement.getAttribute('data-' + lang);
        if (newTitle) {
            titleElement.textContent = newTitle;
        }
    }

    // Traduire tous les éléments avec la classe 'translatable'
    document.querySelectorAll('.translatable').forEach(el => {
        const translation = el.getAttribute('data-' + lang);
        if (translation) {
            el.innerHTML = translation;
        }
    });
}
// Initialiser la langue par défaut au chargement (français)
setLanguage('fr');

/* --- TICKER PRIX COINGECKO --- */
const barCoins = [
    { id:"ethereum",     symbol:"ETH" },
    { id:"binancecoin",  symbol:"BNB" },
    { id:"solana",       symbol:"SOL" },
    { id:"ripple",       symbol:"XRP" },
    { id:"litecoin",     symbol:"LTC" },
    { id:"bitcoin-cash", symbol:"BCH" },
    { id:"dogecoin",     symbol:"DOGE" },
    { id:"tron",         symbol:"TRX" },
    { id:"bitcoin",      symbol:"BTC" }
];
async function loadTicker() {
    try {
        const ids  = barCoins.map(c => c.id).join(",");
        const url  = "https://api.coingecko.com/api/v3/simple/price?ids=" + ids + "&vs_currencies=usd&include_24hr_change=true";
        const res  = await fetch(url);
        const data = await res.json();
        const track = document.getElementById("ticker-track");
        track.innerHTML = "";
        barCoins.forEach(c => {
            const info = data[c.id];
            if (!info) return;
            const price  = info.usd;
            const change = info.usd_24h_change || 0;
            const cls    = change >= 0 ? "up" : "down";
            const changeStr = (change >= 0 ? "+" : "") + change.toFixed(2) + "%";
            track.insertAdjacentHTML(
                "beforeend",
                `<div class="ticker-item">
                    <span>${c.symbol}</span>
                    <span>$${price.toLocaleString("en-US",{maximumFractionDigits:2})}</span>
                    <span class="ticker-change ${cls}">${changeStr}</span>
                </div>`
            );
        });
        // Dupliquer le contenu pour permettre le scroll infini
        track.innerHTML += track.innerHTML; 
    } catch (e) {
        console.error("Ticker error:", e);
        const track = document.getElementById("ticker-track");
        if (track.textContent === "Loading...") {
            track.textContent = "Error loading market data.";
        }
    }
}
loadTicker();
// Rafraîchir toutes les 60 secondes
setInterval(loadTicker, 60000);

/* --- PRIX LUMA GECKOTERMINAL --- */
function formatLumaPrice(price) {
    if (!isFinite(price) || price <= 0) return "Price unavailable";
    if (price >= 0.01) {
        return "$" + price.toFixed(4);
    }
    // Formattage pour les petits nombres (ex: $0.0000001234)
    if (price < 0.01 && price > 0) {
        let s = price.toFixed(10);
        s = s.replace(/0+$/,"").replace(/\.$/,"");
        return "$" + s;
    }
    return "$" + price.toExponential(4);
}
async function loadLumaPrice() {
    // Pool LUMA / WBNB sur BSC
    const url = "https://api.geckoterminal.com/api/v2/networks/bsc/pools/0xc4ce7c692fdd27603437199c9b40baf5e2b804e6";
    const priceEl  = document.getElementById("luma-price");
    const changeEl = document.getElementById("luma-change");
    try {
        const res  = await fetch(url);
        const data = await res.json();
        const attr = data?.data?.attributes;
        if (!attr) {
            priceEl.textContent  = "Price unavailable";
            changeEl.textContent = "N/A (24h)";
            changeEl.classList.remove("down");
            return;
        }
        const price =
            Number(attr.base_token_price_usd ?? 
                        attr.quote_token_price_usd ?? 
                        attr.price_usd ?? 
                        0);
        const change =
            Number(
                (attr.price_change_percentage && attr.price_change_percentage.h24) ??
                attr.price_change_percentage_24h ??
                0
            );
        priceEl.textContent = formatLumaPrice(price);
        const isUp = change >= 0;
        changeEl.classList.toggle("down", !isUp);
        changeEl.classList.toggle("up", isUp);
        const sign = isUp ? "+" : "";
        changeEl.textContent = `${sign}${change.toFixed(2)}% (24h)`;
    } catch (e) {
        console.error("LUMA price error:", e);
        priceEl.textContent  = "Price unavailable";
        changeEl.textContent = "N/A (24h)";
        changeEl.classList.remove("down","up");
    }
}
loadLumaPrice();
// Rafraîchir toutes les 60 secondes
setInterval(loadLumaPrice, 60000);
