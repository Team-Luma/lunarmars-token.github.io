que pense tu de ca <!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LUMA | Lunar&Mars Mission Control</title>
    <link rel="icon" href="Luma-logo.png" />
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4L8P2YSD7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Z4L8P2YSD7');
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: {
                        bg: '#050505',
                        panel: '#0F0F12',
                        brand: '#ffb21a',
                        accent: '#3b82f6',
                        success: '#10b981',
                        danger: '#ef4444'
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scroll-ticker': 'scroll 40s linear infinite',
                    },
                    keyframes: {
                        scroll: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-100%)' } }
                    }
                }
            }
        }
    </script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: #050505; color: #e5e5e5; overflow-x: hidden; }
        
        /* Glassmorphism & Tech Cards */
        .tech-card {
            background: rgba(15, 15, 18, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            transition: border-color 0.3s ease, transform 0.3s ease;
        }
        .tech-card:hover { border-color: rgba(255, 255, 255, 0.2); transform: translateY(-2px); }

        .data-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: #6b7280; font-weight: 600; margin-bottom: 0.25rem; }
        .data-value { font-family: 'JetBrains Mono', monospace; font-weight: 700; color: white; }
        
        /* Grid Background */
        .grid-bg {
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* M√©t√©o Overlay */
        #weather-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 40; overflow: hidden; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    </style>
</head>

<body class="antialiased grid-bg relative">

    <div id="weather-overlay"></div>

    <div id="festival-bar" class="hidden fixed top-0 w-full z-[70] bg-gradient-to-r from-indigo-900 via-purple-900 to-indigo-900 border-b border-white/20 text-white text-xs font-semibold text-center py-2 shadow-lg">
        <span id="festival-text"></span>
    </div>

    <nav id="mainNav" class="fixed top-0 w-full z-50 border-b border-white/10 bg-[#050505]/90 backdrop-blur-xl h-16 flex items-center transition-all duration-300">
        <div class="max-w-[1400px] w-full mx-auto px-4 md:px-6 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="Luma-logo.png" alt="LUMA" class="w-10 h-10 rounded-lg shadow-lg hover:scale-105 transition-transform">
                <div class="hidden md:block">
                    <span class="font-bold tracking-tight text-lg block leading-none text-white">Lunar&Mars</span>
                    <span class="text-[10px] text-brand font-mono tracking-widest">MISSION CONTROL</span>
                </div>
            </div>

            <div class="hidden lg:flex items-center gap-6 text-xs font-medium text-gray-400 font-mono">
                <a href="#dashboard" class="hover:text-white transition-colors">DASHBOARD</a>
                <a href="#iss-section" class="hover:text-white transition-colors">ISS & VOYAGER</a>
                <a href="#news-section" class="hover:text-white transition-colors">INTEL FEED</a>
                <a href="#manifesto" class="hover:text-white transition-colors">MANIFESTO</a>
                <a href="#" onclick="openGamePopup()" class="text-brand hover:text-white flex items-center gap-1"><i data-lucide="gamepad-2" class="w-3 h-3"></i> ARCADE</a>
            </div>

            <div class="flex items-center gap-3">
                <a href="https://pancakeswap.finance/swap?outputCurrency=0xEA6C0908734D7cADc10C01b2e4E9d8e1664EECc9&chainId=56" target="_blank" class="bg-white text-black px-4 py-2 rounded text-xs font-bold hover:bg-gray-200 transition-all uppercase tracking-wider flex items-center gap-2">
                    <span>Initialiser Achat</span>
                </a>
            </div>
        </div>
    </nav>

    <div id="tickerBar" class="fixed top-16 w-full z-40 bg-[#0a0a0c] border-b border-white/5 backdrop-blur-md overflow-hidden h-8 flex items-center">
        <div class="whitespace-nowrap animate-scroll-ticker flex gap-8 px-4 text-xs font-mono" id="ticker-track">
            <span class="text-gray-500">Connexion aux satellites financiers...</span>
        </div>
    </div>

    <main id="mainContent" class="relative pt-32 pb-20 px-4 md:px-6 max-w-[1400px] mx-auto space-y-6">

        <div id="dashboard" class="grid grid-cols-1 md:grid-cols-12 gap-4">
            
            <div class="md:col-span-12 lg:col-span-6 tech-card rounded-2xl p-6 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition"><i data-lucide="orbit" class="w-32 h-32 text-brand"></i></div>
                <div class="relative z-10 h-full flex flex-col justify-between">
                    <div>
                        <div class="inline-flex items-center gap-2 px-2 py-1 rounded border border-green-500/30 bg-green-500/10 text-green-400 text-[10px] font-mono mb-4">
                            <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span>
                            SYST√àMES NOMINAUX
                        </div>
                        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">LUMA INDEX</h1>
                        <p class="text-sm text-gray-400 leading-relaxed max-w-lg">
                            L'interface de convergence entre la blockchain Almagest, l'innovation technologique et l'expansion vers Mars. 
                        </p>
                    </div>
                    <div class="mt-8 grid grid-cols-3 gap-4 border-t border-white/5 pt-4">
                        <div>
                            <div class="data-label">PRIX (USD)</div>
                            <div id="livePrice" class="data-value text-xl">Loading</div>
                        </div>
                        <div>
                            <div class="data-label">VAR 24H</div>
                            <div id="liveChange" class="data-value text-xl">--%</div>
                        </div>
                        <div>
                            <div class="data-label">MARKET CAP</div>
                            <div class="data-value text-xl text-gray-400">Micro</div>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-3">
                        <button id="copyBtn" class="text-[10px] border border-white/20 px-3 py-1 rounded hover:bg-white/10 text-gray-300 transition flex items-center gap-2">
                            <i data-lucide="copy" class="w-3 h-3"></i> 0xEA...ECC9
                        </button>
                        <button id="addMetaMask" class="text-[10px] border border-[#f6851b]/30 px-3 py-1 rounded hover:bg-[#f6851b]/10 text-[#f6851b] transition flex items-center gap-2">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" class="w-3 h-3"> MetaMask
                        </button>
                    </div>
                </div>
            </div>

            <div class="md:col-span-6 lg:col-span-3 tech-card rounded-2xl p-6 flex flex-col justify-between relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-blue-500/5 to-transparent pointer-events-none"></div>
                <div>
                    <div class="flex justify-between items-start mb-2">
                        <div class="data-label">ENVIRONNEMENT LOCAL</div>
                        <i id="weather-icon" data-lucide="scan" class="w-4 h-4 text-gray-500"></i>
                    </div>
                    <div id="wxLabel" class="text-3xl font-mono font-bold text-white">--¬∞C</div>
                    <div id="geoStatus" class="text-[10px] text-gray-500 font-mono mt-1">En attente GPS...</div>
                </div>
                <div class="mt-4 pt-4 border-t border-white/5">
                    <div class="data-label mb-1">DISTANCE ISS (RELATIVE)</div>
                    <div id="issDistance" class="text-xl font-mono text-accent">-- km</div>
                    <div class="text-[10px] text-gray-500">Bas√© sur votre position r√©elle</div>
                </div>
            </div>

            <div class="md:col-span-6 lg:col-span-3 tech-card rounded-2xl p-6 relative">
                <div class="data-label mb-4">HORLOGE COSMIQUE</div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center border-b border-white/5 pb-2">
                        <span class="text-xs text-gray-400">TERRE (UTC)</span>
                        <span id="earth-clock" class="font-mono text-white text-right">--:--:--</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-white/5 pb-2">
                        <span class="text-xs text-brand">MARS (SOL)</span>
                        <span id="mars-clock" class="font-mono text-brand text-right">--:--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-400">PHASE LUNE</span>
                        <span id="moon-phase" class="font-mono text-white text-right">--</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="iss-section" class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            
            <div class="tech-card rounded-2xl p-6 relative overflow-hidden">
                <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-blue-500/10 rounded-full blur-3xl"></div>
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="satellite" class="text-blue-400"></i>
                    <h3 class="font-bold text-lg text-white">VOYAGER LIVE TRACKING</h3>
                    <span class="text-[10px] border border-blue-500/30 text-blue-400 px-2 rounded bg-blue-500/10">INTERSTELLAIRE</span>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between items-end mb-1">
                            <span class="text-sm font-bold text-white">VOYAGER 1</span>
                            <span class="text-[10px] text-gray-500">LAUNCH: 1977</span>
                        </div>
                        <div class="data-label">DISTANCE TERRE</div>
                        <div id="v1-dist" class="text-2xl font-mono text-blue-200">Calcul...</div>
                        <div class="w-full bg-gray-800 h-1 rounded-full mt-2 overflow-hidden">
                            <div class="bg-blue-500 h-full w-[99%] animate-pulse"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-end mb-1">
                            <span class="text-sm font-bold text-white">VOYAGER 2</span>
                            <span class="text-[10px] text-gray-500">HELIOSPAUSE FRANCHIE</span>
                        </div>
                        <div class="data-label">DISTANCE TERRE</div>
                        <div id="v2-dist" class="text-xl font-mono text-gray-300">Calcul...</div>
                    </div>
                </div>
            </div>

            <div class="tech-card rounded-2xl p-6 relative flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg flex items-center gap-2 text-white"><i data-lucide="globe" class="text-green-400"></i> ISS ORBITAL DATA</h3>
                    <div class="flex items-center gap-2">
                         <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                         <span class="text-[10px] font-mono text-red-400">LIVE API</span>
                    </div>
                </div>
                
                <div class="flex-1 bg-[#0a0a0c] rounded-lg border border-white/5 relative overflow-hidden flex items-center justify-center min-h-[200px] group">
                    <div class="absolute inset-0 opacity-30 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-blue-900/40 via-[#050505] to-[#050505]"></div>
                    <div class="grid-bg absolute inset-0 opacity-50"></div>
                    
                    <div class="text-center z-10 space-y-4">
                        <div class="data-label">COORDONN√âES ORBITALES</div>
                        <div class="font-mono text-3xl text-white tracking-tighter">
                            <span id="iss-lat">LAT --.--</span><br>
                            <span id="iss-lon" class="text-gray-400">LON --.--</span>
                        </div>
                        <div class="text-xs text-green-400 font-mono border border-green-500/20 bg-green-500/10 px-3 py-1 rounded-full inline-block">
                            VITESSE: ~27,600 km/h
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="news-section" class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            
            <div class="lg:col-span-2 tech-card rounded-2xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-lg text-white">FLUX D'INFORMATION</h3>
                    <div class="flex gap-2 text-[10px] font-mono">
                        <span class="text-brand">CRYPTO API</span>
                        <span class="text-blue-400">SPACE API</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-xs font-bold text-blue-400 mb-3 border-b border-white/10 pb-2">SPACEFLIGHT NEWS</h4>
                        <div id="spaceNews" class="space-y-3">Chargement...</div>
                    </div>
                    <div>
                        <h4 class="text-xs font-bold text-brand mb-3 border-b border-white/10 pb-2">CRYPTO INTELLIGENCE</h4>
                        <div id="cryptoNews" class="space-y-3">Chargement...</div>
                    </div>
                </div>
            </div>

            <div class="tech-card rounded-2xl p-6">
                <h3 class="font-bold text-lg mb-6 text-white">MISSIONS ACTIVES</h3>
                <div class="space-y-4">
                    <div class="p-3 bg-white/5 rounded border-l-2 border-brand">
                        <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                            <span>LUMA PROTOCOL</span>
                            <span class="text-brand">LIVE</span>
                        </div>
                        <div class="text-sm font-bold text-white">PHASE 2: CONSTRUCTION</div>
                        <div class="text-xs text-gray-500 mt-1">Expansion communaut√© & utilit√©.</div>
                    </div>
                    <div class="p-3 bg-white/5 rounded border-l-2 border-green-500">
                        <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                            <span>ARTEMIS II</span>
                            <span class="text-green-400">PREP</span>
                        </div>
                        <div class="text-sm font-bold text-white">NASA / CNSA</div>
                        <div class="text-xs text-gray-500 mt-1">Retour habit√© orbite lunaire.</div>
                    </div>
                    <div class="p-3 bg-white/5 rounded border-l-2 border-blue-500">
                        <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                            <span>STARSHIP</span>
                            <span class="text-blue-400">TEST</span>
                        </div>
                        <div class="text-sm font-bold text-white">SPACEX</div>
                        <div class="text-xs text-gray-500 mt-1">D√©veloppement lanceur lourd Mars.</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="manifesto" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-20">
            <div class="tech-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold mb-4 text-brand">VISION & MANIFESTE</h2>
                <p class="text-gray-400 text-sm leading-relaxed mb-4">
                    LUMA n'est pas seulement un actif num√©rique. C'est un indice symbolique de la progression humaine. 
                    Nous construisons le pont financier et culturel entre la Terre, la Lune et Mars.
                </p>
                <p class="text-gray-400 text-sm leading-relaxed">
                    Dans une √©conomie multi-plan√©taire, la d√©centralisation n'est pas une option, c'est une n√©cessit√© physique. 
                    LUMA pr√©pare ce terrain √† travers l'√©ducation, la communaut√© et la technologie Almagest.
                </p>
            </div>
            
            <div class="tech-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold mb-4 text-white">TIMELINE FUTURISTE</h2>
                <div class="border-l border-white/10 ml-2 space-y-6">
                    <div class="pl-6 relative">
                        <span class="absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full bg-green-500"></span>
                        <div class="text-xs text-green-400 font-mono mb-1">Q1 2026</div>
                        <div class="font-bold text-sm text-white">Lancement Infrastructure Almagest</div>
                    </div>
                    <div class="pl-6 relative">
                        <span class="absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full bg-white/20"></span>
                        <div class="text-xs text-gray-500 font-mono mb-1">2027</div>
                        <div class="font-bold text-sm text-gray-300">Int√©gration Flux Donn√©es Satellitaires</div>
                    </div>
                    <div class="pl-6 relative">
                        <span class="absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full bg-brand/50"></span>
                        <div class="text-xs text-gray-500 font-mono mb-1">2030+</div>
                        <div class="font-bold text-sm text-gray-300">Premi√®re Tx LUMA Terre-Mars</div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div class="fixed bottom-6 right-6 z-40">
        <button onclick="toggleExplorerMode()" class="bg-white text-black px-6 py-3 rounded-full font-bold shadow-lg hover:scale-105 transition-transform flex items-center gap-2">
            <i data-lucide="telescope" class="w-4 h-4"></i> MODE EXPLORATEUR
        </button>
    </div>

    <footer class="border-t border-white/5 bg-[#020202] py-12">
        <div class="max-w-[1400px] mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-8 text-xs text-gray-500">
            <div class="col-span-1 md:col-span-2">
                <img src="Luma-logo.png" class="w-8 h-8 rounded mb-4 shadow-md">
                <p>Donn√©es temps r√©el fournies via API publiques (OpenMeteo, WhereTheISS, SpaceFlightNews). LUMA est un token communautaire BEP-20.</p>
                <p class="mt-2">&copy; 2026 Lunar&Mars Project.</p>
            </div>
            <div>
                <h4 class="text-white font-bold mb-3">ARCHIVES HISTORIQUES</h4>
                <ul class="space-y-2">
                    <li><a href="#" class="hover:text-brand">Programme Apollo</a></li>
                    <li><a href="#" class="hover:text-brand">Mars Pathfinder</a></li>
                    <li><a href="#" class="hover:text-brand">Sondes Voyager</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold mb-3">DONN√âES</h4>
                <ul class="space-y-2">
                    <li><a href="LUMA_Whitepaper_v1.1.pdf" target="_blank" class="hover:text-brand">Whitepaper V1.1</a></li>
                    <li><a href="https://bscscan.com/token/0xEA6C0908734D7cADc10C01b2e4E9d8e1664EECc9" target="_blank" class="hover:text-brand">BscScan</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();
        const CONTRACT_ADDRESS = '0xEA6C0908734D7cADc10C01b2e4E9d8e1664EECc9';
        const $ = (id) => document.getElementById(id);

        // --- 1. BANDEAU F√äTES / CALENDRIER ---
        function setFestivalBar() {
            const now = new Date();
            const month = now.getMonth(); // 0 = Janvier
            const day = now.getDate();
            const bar = $("festival-bar");
            const txt = $("festival-text");
            const nav = $("mainNav");
            const ticker = $("tickerBar");
            const main = $("mainContent");

            let message = "";
            let show = false;

            // Logique : Nouvel An (1-15 Janvier)
            if (month === 0 && day <= 15) {
                message = "‚ú® BONNE ANN√âE 2026 ! LUMA vous souhaite une ann√©e d'expansion cosmique.";
                show = true;
            } 
            // Logique : No√´l (20-31 D√©cembre)
            else if (month === 11 && day >= 20) {
                message = "üéÑ AIRDROP DE NO√ãL EN COURS - V√âRIFIEZ VOS WALLETS !";
                show = true;
            }

            if (show) {
                txt.textContent = message;
                bar.classList.remove("hidden");
                // Ajustement du layout
                nav.style.top = "32px";
                ticker.style.top = "96px";
                main.style.paddingTop = "12rem";
            } else {
                bar.classList.add("hidden");
                nav.style.top = "0px";
                ticker.style.top = "64px";
                main.style.paddingTop = "10rem";
            }
        }
        setFestivalBar();

        // --- 2. G√âOLOCALISATION & M√âT√âO VISUELLE ---
        let stopParticles = null;

        function clearWeatherOverlay() {
            $("weather-overlay").innerHTML = "";
        }

        function spawnParticles(char, rateMs) {
            const w = $("weather-overlay");
            const timer = setInterval(() => {
                const p = document.createElement("div");
                p.className = "absolute top-[-20px] text-white/60 pointer-events-none";
                p.textContent = char;
                p.style.left = Math.random() * 100 + "vw";
                p.style.fontSize = (10 + Math.random() * 14) + "px";
                p.style.opacity = (0.3 + Math.random() * 0.5).toString();
                const dur = 4 + Math.random() * 4;
                p.style.transition = `transform ${dur}s linear, opacity ${dur}s linear`;
                w.appendChild(p);

                requestAnimationFrame(() => {
                    p.style.transform = `translateY(110vh) translateX(${(-20 + Math.random()*40)}px)`;
                    p.style.opacity = "0";
                });

                setTimeout(() => p.remove(), dur * 1000);
            }, rateMs);
            return () => clearInterval(timer);
        }

        function applyWeatherEffect(mode) {
            clearWeatherOverlay();
            if (stopParticles) stopParticles();

            if (mode === "snow") stopParticles = spawnParticles("‚ùÑ", 200);
            else if (mode === "rain") stopParticles = spawnParticles("üíß", 80);
            else if (mode === "storm") {
                stopParticles = spawnParticles("‚ö°", 300); // √âclairs symboliques ou pluie
                // On peut ajouter un effet flash ici si voulu
            }
        }

        // --- 3. APIs : WEATHER & ISS DISTANCE ---
        function haversineKm(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const toRad = x => x * Math.PI / 180;
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
            return 2 * R * Math.asin(Math.sqrt(a));
        }

        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(async (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                $("geoStatus").innerText = `${lat.toFixed(2)}, ${lon.toFixed(2)}`;

                // M√©t√©o
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                    const data = await res.json();
                    const code = data.current_weather.weathercode;
                    const temp = data.current_weather.temperature;
                    
                    $("wxLabel").innerText = `${temp}¬∞C`;
                    
                    let mode = "clear";
                    if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) mode = "rain";
                    if (code >= 71 && code <= 77) mode = "snow";
                    if (code >= 95) mode = "storm";
                    
                    applyWeatherEffect(mode);
                } catch(e) { console.error("Weather error", e); }

                // ISS Distance relative
                setInterval(async () => {
                    try {
                        const r = await fetch("https://api.wheretheiss.at/v1/satellites/25544");
                        const j = await r.json();
                        // Update UI ISS
                        $("iss-lat").innerText = `LAT ${j.latitude.toFixed(2)}`;
                        $("iss-lon").innerText = `LON ${j.longitude.toFixed(2)}`;
                        
                        // Distance
                        const dist = haversineKm(lat, lon, j.latitude, j.longitude);
                        $("issDistance").innerText = `${Math.round(dist).toLocaleString()} km`;
                    } catch(e){}
                }, 5000);

            }, () => {
                $("geoStatus").innerText = "GPS Refus√© - Mode global";
            });
        }

        // --- 4. NEWS FEEDS ---
        async function fetchSpaceNews() {
            try {
                const r = await fetch("https://api.spaceflightnewsapi.net/v4/articles/?limit=3");
                const j = await r.json();
                $("spaceNews").innerHTML = j.results.map(a => `
                    <div class="border-b border-white/5 last:border-0 pb-2 mb-2">
                        <a href="${a.url}" target="_blank" class="text-xs text-blue-300 hover:text-white transition block truncate">${a.title}</a>
                        <span class="text-[10px] text-gray-500">${new Date(a.published_at).toLocaleDateString()}</span>
                    </div>
                `).join('');
            } catch(e) { $("spaceNews").innerHTML = "<div class='text-xs text-red-400'>Flux indisponible</div>"; }
        }

        async function fetchCryptoNews() {
            try {
                const r = await fetch("https://min-api.cryptocompare.com/data/v2/news/?lang=EN");
                const j = await r.json();
                const items = j.Data.slice(0, 3);
                $("cryptoNews").innerHTML = items.map(n => `
                     <div class="border-b border-white/5 last:border-0 pb-2 mb-2">
                        <a href="${n.url}" target="_blank" class="text-xs text-brand hover:text-white transition block truncate">${n.title}</a>
                        <span class="text-[10px] text-gray-500">${new Date(n.published_on * 1000).toLocaleDateString()}</span>
                    </div>
                `).join('');
            } catch(e) { 
                // Fallback si CORS bloque
                $("cryptoNews").innerHTML = "<div class='text-[10px] text-gray-500'>Donn√©es prot√©g√©es (CORS). Installez un proxy.</div>"; 
            }
        }
        fetchSpaceNews();
        fetchCryptoNews();

        // --- 5. VOYAGER SIMULATION (MATHS) ---
        function updateVoyager() {
            const startTimestamp = 1704067200000; // 1 Jan 2024
            const v1Start = 24400000000; const v1Speed = 17; // km/s
            const v2Start = 20300000000; const v2Speed = 15; // km/s
            
            const now = Date.now();
            const elapsed = (now - startTimestamp) / 1000;
            
            const d1 = v1Start + (elapsed * v1Speed);
            const d2 = v2Start + (elapsed * v2Speed);
            
            $("v1-dist").innerText = Math.floor(d1).toLocaleString() + " km";
            $("v2-dist").innerText = Math.floor(d2).toLocaleString() + " km";
        }
        setInterval(updateVoyager, 1000);

        // --- 6. HORLOGES & TICKER ---
        function updateClocks() {
            const now = new Date();
            $("earth-clock").innerText = now.toISOString().split('T')[1].split('.')[0] + " UTC";
            
            // Sol Martien (Approx)
            const millisPerSol = 88775244;
            const msPassed = now.getTime() - 947116800000;
            const sols = msPassed / millisPerSol;
            const solDay = Math.floor(sols) + 44796;
            const solTime = (sols % 1) * 24;
            const h = Math.floor(solTime);
            const m = Math.floor((solTime - h) * 60);
            $("mars-clock").innerText = `Sol ${solDay} ${h}:${m < 10 ? '0'+m : m}`;
        }
        setInterval(updateClocks, 1000);

        // Crypto Ticker & Price
        const barCoins = [{id:"bitcoin", sym:"BTC"}, {id:"binancecoin", sym:"BNB"}, {id:"solana", sym:"SOL"}];
        async function fetchMarket() {
            try {
                // LUMA Price
                const rLuma = await fetch("https://api.geckoterminal.com/api/v2/networks/bsc/pools/0xc4ce7c692fdd27603437199c9b40baf5e2b804e6");
                const dLuma = await rLuma.json();
                const attr = dLuma.data.attributes;
                const p = parseFloat(attr.base_token_price_usd);
                const c = parseFloat(attr.price_change_percentage.h24);
                
                $("livePrice").innerText = p < 0.01 ? '$'+p.toFixed(8) : '$'+p.toFixed(4);
                const cEl = $("liveChange");
                cEl.innerText = (c>=0?'+':'') + c.toFixed(2) + '%';
                cEl.className = `data-value text-xl ${c>=0?'text-green-400':'text-red-400'}`;

                // Ticker
                const ids = barCoins.map(x=>x.id).join(',');
                const rCoins = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`);
                const dCoins = await rCoins.json();
                
                let html = `<span class="font-bold text-brand">LUMA $${p.toFixed(8)}</span> <span class="mx-4 text-gray-600">|</span> `;
                barCoins.forEach(coin => {
                    const data = dCoins[coin.id];
                    if(data) {
                        const chg = data.usd_24h_change;
                        html += `<span class="text-gray-300">${coin.sym} $${data.usd} <span class="${chg>=0?'text-green-500':'text-red-500'}">(${chg.toFixed(1)}%)</span></span> <span class="mx-4 text-gray-600">|</span> `;
                    }
                });
                $("ticker-track").innerHTML = html + html; // Duplicate for scroll
            } catch(e){}
        }
        fetchMarket();
        setInterval(fetchMarket, 60000);

        // --- 7. UTILS (Copy/MetaMask/Game) ---
        $("copyBtn").addEventListener('click', () => {
            navigator.clipboard.writeText(CONTRACT_ADDRESS);
            alert("Adresse copi√©e !");
        });
        
        $("addMetaMask").addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_watchAsset',
                        params: {
                            type: 'ERC20',
                            options: {
                                address: CONTRACT_ADDRESS,
                                symbol: 'LUMA',
                                decimals: 18,
                                image: window.location.origin + '/Luma-logo.png',
                            },
                        },
                    });
                } catch (e) {}
            } else alert("MetaMask introuvable");
        });

        function toggleExplorerMode() {
            alert("Mode Explorateur (3D) en cours de d√©veloppement pour la V2.");
        }
        function openGamePopup() {
            window.open('game/luma-game.html', 'LUMA_ARCADE', 'width=500,height=750,resizable=yes,scrollbars=no');
        }
    </script>
</body>
</html>
